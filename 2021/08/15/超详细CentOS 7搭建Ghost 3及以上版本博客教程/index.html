<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>超详细CentOS 7搭建Ghost 3及以上版本博客教程 | 北山居士</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="环境要求 centos 7 x86_64 nodejs 8.x LTS 支持 10.x LTS 支持 内存 ≥ 1GB，若小于1GB，则需添加swap分区 ghost 3.x   提示：&lt;user&gt;为普通用户，因为ghost不建议使用root账户执行，但是有些操作需要使用sudo，所以新建一个普通用户并加入sudo授权。  创建用户使用root新建用户为用户名，-m为创建用户主目录：">
<meta property="og:type" content="article">
<meta property="og:title" content="超详细CentOS 7搭建Ghost 3及以上版本博客教程">
<meta property="og:url" content="http://example.com/2021/08/15/%E8%B6%85%E8%AF%A6%E7%BB%86CentOS%207%E6%90%AD%E5%BB%BAGhost%203%E5%8F%8A%E4%BB%A5%E4%B8%8A%E7%89%88%E6%9C%AC%E5%8D%9A%E5%AE%A2%E6%95%99%E7%A8%8B/index.html">
<meta property="og:site_name" content="北山居士">
<meta property="og:description" content="环境要求 centos 7 x86_64 nodejs 8.x LTS 支持 10.x LTS 支持 内存 ≥ 1GB，若小于1GB，则需添加swap分区 ghost 3.x   提示：&lt;user&gt;为普通用户，因为ghost不建议使用root账户执行，但是有些操作需要使用sudo，所以新建一个普通用户并加入sudo授权。  创建用户使用root新建用户为用户名，-m为创建用户主目录：">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-08-15T08:13:10.698Z">
<meta property="article:modified_time" content="2021-08-15T08:13:37.599Z">
<meta property="article:author" content="Art3mis">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="北山居士" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">北山居士</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">教程仓库</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS 订阅"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-超详细CentOS 7搭建Ghost 3及以上版本博客教程" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/08/15/%E8%B6%85%E8%AF%A6%E7%BB%86CentOS%207%E6%90%AD%E5%BB%BAGhost%203%E5%8F%8A%E4%BB%A5%E4%B8%8A%E7%89%88%E6%9C%AC%E5%8D%9A%E5%AE%A2%E6%95%99%E7%A8%8B/" class="article-date">
  <time class="dt-published" datetime="2021-08-15T08:13:10.698Z" itemprop="datePublished">2021-08-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      超详细CentOS 7搭建Ghost 3及以上版本博客教程
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="环境要求"><a href="#环境要求" class="headerlink" title="环境要求"></a>环境要求</h1><ul>
<li>centos 7 x86_64</li>
<li>nodejs</li>
<li>8.x LTS 支持</li>
<li>10.x LTS 支持</li>
<li>内存 ≥ 1GB，若小于1GB，则需添加swap分区</li>
<li>ghost 3.x</li>
</ul>
<blockquote>
<p>提示：<code>&lt;user&gt;</code>为普通用户，因为ghost不建议使用root账户执行，但是有些操作需要使用sudo，所以新建一个普通用户并加入sudo授权。</p>
</blockquote>
<h1 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h1><p>使用root新建用户<user>为用户名，-m为创建用户主目录：</p>
<pre><code>[root@host ~]# useradd &lt;user&gt; -m
[root@host ~]# passwd &lt;user&gt;    # 在下一行设置用户密码
</code></pre>
<p>给创建的用户设置权限：</p>
<pre><code>[root@host ~]# visudo
</code></pre>
<p>在打开的文本中找到下面的内容，参照root的格式，添加下一行：</p>
<pre><code>## Allow root to run any commands anywhere
root    ALL=(ALL)       ALL
&lt;user&gt;  ALL=(ALL)       ALL
</code></pre>
<h1 id="添加repo"><a href="#添加repo" class="headerlink" title="添加repo"></a>添加repo</h1><h2 id="添加nginx-repo"><a href="#添加nginx-repo" class="headerlink" title="添加nginx repo"></a>添加nginx repo</h2><pre><code>[root@host ~]# vim /etc/yum.repos.d/nginx.repo
</code></pre>
<p>在新建文本中粘贴以下内容，并保存退出：</p>
<pre><code>[nginx]
name=nginx repo
baseurl=http://nginx.org/packages/centos/$releasever/$basearch/
gpgcheck=1
enabled=1
gpgkey=https://nginx.org/keys/nginx_signing.key
</code></pre>
<h2 id="添加nodejs-repo"><a href="#添加nodejs-repo" class="headerlink" title="添加nodejs repo"></a>添加nodejs repo</h2><pre><code>[root@host ~]# curl -sL https://rpm.nodesource.com/setup_10.x | sudo bash -
</code></pre>
<h2 id="添加yarn-repo"><a href="#添加yarn-repo" class="headerlink" title="添加yarn repo"></a>添加yarn repo</h2><pre><code>[root@host ~]# curl -sL https://dl.yarnpkg.com/rpm/yarn.repo | tee /etc/yum.repos.d/yarn.repo
</code></pre>
<h1 id="安装软件"><a href="#安装软件" class="headerlink" title="安装软件"></a>安装软件</h1><pre><code>[root@host ~]# yum install gcc-c++ make nginx yarn nodejs -y
</code></pre>
<h1 id="安装mySQL（mariadb）"><a href="#安装mySQL（mariadb）" class="headerlink" title="安装mySQL（mariadb）"></a>安装mySQL（mariadb）</h1><ol>
<li><p>下载安装：</p>
<pre><code> [root@host ~]# yum install mariadb-server -y
</code></pre>
</li>
<li><p>设置开机启动服务：</p>
<pre><code> [root@host ~]# systemctl enable mariadb.service
</code></pre>
</li>
<li><p>启动mySQL服务：</p>
<pre><code> [root@host ~]# systemctl start mariadb.service
</code></pre>
</li>
</ol>
<h1 id="设置mariadb数据库"><a href="#设置mariadb数据库" class="headerlink" title="设置mariadb数据库"></a>设置mariadb数据库</h1><pre><code>[root@host ~]# mysql_secure_installation

#新安装的mariadb的初始密码为空。先直接回车登录，然后再根据提示设置mariadb root的密码，接着后面全部回车保持默认即可
</code></pre>
<h3 id="添加ghost的数据库及所属用户"><a href="#添加ghost的数据库及所属用户" class="headerlink" title="添加ghost的数据库及所属用户"></a>添加ghost的数据库及所属用户</h3><p>在开始正式安装前，需要先添加一下数据库及所属用户，不然会在后面的步骤中提示错误，因为ghost建议使用普通用户执行，所以普通用户没有权限登陆mysql，即便是密码正确的情况下。</p>
<pre><code>[root@host ~]# mysql -uroot -p&lt;刚刚设置的mariadb root的密码&gt;

MariaDB [(none)]&gt; create database &lt;数据库名称&gt;;
MariaDB [(none)]&gt; create user &lt;数据库用户名&gt; identified by &#39;&lt;数据库密码&gt;&#39;;
MariaDB [(none)]&gt; grant all privileges on &lt;数据库名称&gt;.* to &lt;数据库用户名&gt;@&#39;localhost&#39; identified by &#39;&lt;数据库密码&gt;&#39;;
MariaDB [(none)]&gt; flush privileges;
MariaDB [(none)]&gt; exit
</code></pre>
<h1 id="创建ghost目录"><a href="#创建ghost目录" class="headerlink" title="创建ghost目录"></a>创建ghost目录</h1><pre><code>[root@host ~]# mkdir -p /var/www/ghost
# 设置权限
[root@host ~]# chown -R &lt;user&gt;:&lt;user&gt; /var/www/ghost
[root@host ~]# chmod -R 775 /var/www/ghost
</code></pre>
<h1 id="安装ghost-cli"><a href="#安装ghost-cli" class="headerlink" title="安装ghost-cli"></a>安装ghost-cli</h1><pre><code>[root@host ~]# npm install ghost-cli@latest -g
</code></pre>
<h1 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h1><pre><code>#先启动nginx和mariadb，安装过程需要连接数据库
[root@host ~]# systemctl enable nginx &amp;&amp; \
    &gt;systemctl enable mariadb.service &amp;&amp; \
    &gt;systemctl start nginx &amp;&amp; \
    &gt;systemctl start mariadb.service
</code></pre>
<h1 id="开始安装ghost"><a href="#开始安装ghost" class="headerlink" title="开始安装ghost"></a>开始安装ghost</h1><p>切换至之前创建的普通用户：</p>
<pre><code>[root@host ~]# su &lt;user&gt;
</code></pre>
<p>跳转至创建的ghost目录下，安装ghost：</p>
<pre><code>[&lt;user&gt;@host ~]# cd /var/www/ghost
[&lt;user&gt;@host ghost]# ghost install

bash
# 如果vps在国内的话，有时候可能会遇到下载失败的问题，再次执行安装的时候会提示
A SystemError occurred.

Message: Current directory is not empty, Ghost cannot be installed here.
#只需要执行rm -rf *，删除全部文件，然后再次执行安装命令即可；如果还是提示目录非空的话，那就删除 .ghost-cli 文件

# 正常安装过程
✔ Checking system Node.js version
✔ Checking logged in user
✔ Checking current folder permissions
System checks failed with message: &#39;Linux version is not Ubuntu 16 or 18&#39;
Some features of Ghost-CLI may not work without additional configuration.
For local installs we recommend using `ghost install local` instead.
? Continue anyway? (Y/n) #提示系统不是ubuntu，是否继续？Y
System stack check skipped
ℹ Checking operating system compatibility [skipped]
✔ Checking for a MySQL installation
✔ Checking memory availability
✔ Checking for latest Ghost version
✔ Setting up install directory
✔ Downloading and installing Ghost v2.23.3
✔ Finishing install process
? Enter your blog URL: http://192.168.70.134 #我在本地测试使用的是IP，如果在vps的话，应该输入站点的域名
? Enter your MySQL hostname: localhost #数据库的机器名称，本机回车即可
? Enter your MySQL username: ghost #上面的SQL语句中创建的数据库用户名
? Enter your MySQL password: [hidden] #上面SQL语句中的数据库密码（非root密码）
? Enter your Ghost database name: ghost_prod #上面SQL语句中的数据库名称
✔ Configuring Ghost
✔ Setting up instance
+ sudo useradd --system --user-group ghost
? Sudo Password [hidden] #当前用户的密码
+ sudo chown -R ghost:ghost /var/www/html/ghost/content
✔ Setting up &quot;ghost&quot; system user
ℹ Setting up &quot;ghost&quot; mysql user [skipped]
Nginx is not installed. Skipping Nginx setup.
ℹ Setting up Nginx [skipped] #跳过了nginx自动配置
Nginx setup task was skipped, skipping SSL setup
ℹ Setting up SSL [skipped] #跳过了nginx ssl配置
? Do you wish to set up Systemd? (Y/n) #是否添加systemd服务？Y
✔ Creating systemd service file at /var/www/html/ghost/system/files/ghost_192-168-70-134.service
+ sudo ln -sf /var/www/html/ghost/system/files/ghost_192-168-70-134.service /lib/systemd/system/ghost_192-168-70-134.service #centos系统记住这个服务名，下面会用到
+ sudo systemctl daemon-reload
✔ Setting up Systemd
? Do you want to start Ghost? No #最后一步选择的是No，因为跳过了nginx设置
</code></pre>
<p>注意：新版ghost在安装完成后会自从启动，启动时会先自动输入<code>sudo systemctl is-active ghost_xxx-xxx-xxx-xxx</code>命令来检查ghost进程是否激活，有可能会遇到unkown导致ghost无法启动的问题。解决办法是先手动输入<code>sudo systemctl start ghost_xxx-xxx-xxx-xxx</code>命令开启进程，然后再输入<code>ghost start</code>命令开启ghost。</p>
<h1 id="添加nginx配置文件"><a href="#添加nginx配置文件" class="headerlink" title="添加nginx配置文件"></a>添加nginx配置文件</h1><p>由于nginx的conf.d目录中已有一个default.conf文件，如果这个机器只有一个ghost网站的话，那么将其重命名，让其失效，然后再次创建一个新的ghost.conf文件：</p>
<pre><code>[root@host ~]# mv /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/default.conf.bak &amp;&amp; \
    &gt;vim /etc/nginx/conf.d/ghost.conf
</code></pre>
<p>粘贴以下内容：</p>
<pre><code>server &#123;
    listen 80;
    listen [::]:80;

    server_name 192.168.70.12; #你的IP或域名
    root /var/www/html/ghost/system/nginx-root; # Used for acme.sh SSL verification (https://acme.sh)

    location / &#123;
        proxy_set_header X-Forwarded-For     $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header Host $http_host;
        proxy_pass http://127.0.0.1:2368;
    &#125;

    location ~ /.well-known &#123;
        allow all;
    &#125;

    client_max_body_size 50m;
&#125;
</code></pre>
<p>重启nginx：</p>
<pre><code>[root@host ~]# systemctl restart nginx
</code></pre>
<!-- # 启动网站

在centOS上不能使用`ghost start`命令，会报错

    bash
    + sudo systemctl is-active ghost_192-168-70-134
    A ProcessError occurred.

    Message: Command failed: /bin/sh -c sudo -S -p '#node-sudo-passwd#'  systemctl is-active ghost_192-168-70-134

    unknown

    Exit code: 3

**在centos7上面得使用**

    [root@host ~]# systemctl start ghost_192-168-70-134 -->

<h1 id="查看状态"><a href="#查看状态" class="headerlink" title="查看状态"></a>查看状态</h1><pre><code>[&lt;user&gt;@host ghost]# ghost status
+ sudo systemctl is-active ghost_192-168-70-134
┌────────────────┬─────────────────────┬─────────┬──────────────────────┬───────────────────────┬──────┬─────────────────┐
│ Name           │ Location            │ Version │ Status               │ URL                   │ Port │ Process Manager │
├────────────────┼─────────────────────┼─────────┼──────────────────────┼───────────────────────┼──────┼─────────────────┤
│ 192-168-70-134 │ /var/www/html/ghost │ 2.23.3  │ running (production) │ http://192.168.70.134 │ 2368 │ systemd         │
└────────────────┴─────────────────────┴─────────┴──────────────────────┴───────────────────────┴──────┴─────────────────┘
</code></pre>
<p>到这，安装就完成~</p>
<h1 id="添加防火墙"><a href="#添加防火墙" class="headerlink" title="添加防火墙"></a>添加防火墙</h1><p>如果防火墙未关闭，添加以下内容：</p>
<pre><code>[root@host ~]# firewall-cmd --add-service=http --permanent &amp;&amp; \
    &gt;firewall-cmd --add-service=https --permanent &amp;&amp; \
    &gt;firewall-cmd --reload
</code></pre>
<h1 id="设置网站管理员账户"><a href="#设置网站管理员账户" class="headerlink" title="设置网站管理员账户"></a>设置网站管理员账户</h1><p>使用域名访问站点后台创建管理员账户</p>
<pre><code>domain.com #网站前台
domain.com/ghost #网站后台
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/08/15/%E8%B6%85%E8%AF%A6%E7%BB%86CentOS%207%E6%90%AD%E5%BB%BAGhost%203%E5%8F%8A%E4%BB%A5%E4%B8%8A%E7%89%88%E6%9C%AC%E5%8D%9A%E5%AE%A2%E6%95%99%E7%A8%8B/" data-id="ckscxmmv50000yo7k4oragwxr" data-title="超详细CentOS 7搭建Ghost 3及以上版本博客教程" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
    
  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/08/15/%E8%B6%85%E8%AF%A6%E7%BB%86CentOS%207%E6%90%AD%E5%BB%BAGhost%203%E5%8F%8A%E4%BB%A5%E4%B8%8A%E7%89%88%E6%9C%AC%E5%8D%9A%E5%AE%A2%E6%95%99%E7%A8%8B/">超详细CentOS 7搭建Ghost 3及以上版本博客教程</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 Art3mis<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>